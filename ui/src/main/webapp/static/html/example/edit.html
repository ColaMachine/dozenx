<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Editable WYSIWYG</title>
    <link href="../../../static/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../static/css/font-awesome-new.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/font-awesome/4.6.1/css/font-awesome.css" rel="stylesheet">

    <style>
        .btn-group{
            display:inline-block;
        }
        #editor {
        resize:vertical;
        overflow:auto;
        border:1px solid silver;
        border-radius:5px;
        min-height:100px;
        box-shadow: inset 0 0 10px silver;
        padding:1em;
        }
        .fengmian img{
            width:auto;
        height:250px;
        margin-bottom:12px;
        }
        .btn{

        }


        .WriteCover-wrapper {
    background: #f6f6f6;
    line-height: 192px;
    color: grey;
    min-height: 192px;
    text-align: center;
}
.WriteIndexLayout-main {
    margin: 47px auto 0;
    width: 660px;
}

.UploadPicture-input {
    display: none!important ;
}


.UploadPicture-wrapper {
    cursor: pointer;
}

.Layout-titleImage--normal .WriteCover-previewWrapper .WriteTitleImage {
    margin-bottom: 0;

}
.Layout-titleImage--normal .WriteTitleImage {
    margin-bottom: 24px;
}
.WriteTitleImage, .WriteTitleImage  {
    display: none;
}


.WriteTitleImage-imagePure {
    width: 100%;
}


.WriteCover-previewWrapper {
    min-height: 192px;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    position: relative;
}

.WriteCover-editWrapper {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    height: 42px;
    position: absolute;
    right: 0;
    bottom: 0;
    z-index: 1;
    background: rgba(18,18,18,.75);
    border-radius: 4px 0 0 0;
    border: 0;
}

.WriteCover-editWrapper .Button, html[data-theme=dark] .WriteCover-editWrapper .Button {
    color: #fff;
}
.WriteCover-editButton {
    height: 42px;
    width: 48px;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    -webkit-box-align: center;
    -ms-flex-align: center;
    align-items: center;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    justify-content: center;
    border: 0;
    border-radius: 0;
    padding: 0;
}
.WriteCover-previewWrapper .UploadPicture-wrapper {
    display: block;
}


    </style>
</head>
<body>
<div class="content WriteIndexLayout-main WriteIndex">

    <button class="btn btn-primary primary" id="submit" onclick="submit()" type="button">发布</button>

    <div class="WriteCover-wrapper">
        <div class="WriteCover-previewWrapper WriteCover-previewWrapper--empty">

            <img style="display:none" src="https://pic1.zhimg.com/v2-81c24be3e0782c447dfae875924d0260.jpeg" style="display: none;">
            <div class="WriteTitleImage">
                <img id="update-img" alt="11111111" src="https://pic1.zhimg.com/v2-81c24be3e0782c447dfae875924d0260.jpeg" class="WriteTitleImage-imagePure WriteTitleImage-imagePure--fixed" height="622">
            </div>

            <div class="WriteCover-editWrapper"><button title="更换" aria-label="更换" type="button" class="Button WriteCover-editButton WriteCover-uploadButton">
                <svg class="Zi Zi--Camera" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M20.094 6S22 6 22 8v10.017S22 20 19 20H4.036S2 20 2 18V7.967S2 6 4 6h3s1-2 2-2h6c1 0 2 2 2 2h3.094zM12 16a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0 1.5a5 5 0 1 0-.001-10.001A5 5 0 0 0 12 17.5zm7.5-8a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill-rule="evenodd"></path></svg></button><button title="删除" aria-label="删除" type="button" class="Button WriteCover-editButton WriteCover-deleteButton">
                <svg class="Zi Zi--TrashOutline" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M16.213 18.638h-7.83V8.085H7.021v10.553c0 .751.611 1.362 1.362 1.362h7.83c.75 0 1.361-.61 1.361-1.362V8.085h-1.361v10.553zM15.19 5.362c0-.751-.61-1.362-1.361-1.362h-3.064c-.751 0-1.362.61-1.362 1.362v.68H6.766S6 6 6 6.715c0 .714.766.69.766.69H17.89s.705 0 .705-.688c0-.689-.705-.673-.705-.673h-2.7v-.681zm-1.361.68h-3.064v-.68h3.064v.68zm-3.745 3.064v8.17h1.362v-8.17h-1.362zm3.064 0v8.17h1.362v-8.17h-1.362z" fill-rule="evenodd">

            </path></svg></button></div>
            <label class="UploadPicture-wrapper">
                <input type="hidden" id="fengmian" value="">
                <input type="file"  id="fileInput" accept=".jpeg, .jpg, .png" class="UploadPicture-input">
                <svg id="upload-svn" class="Zi Zi--Camera WriteCover-uploadIcon" fill="currentColor" viewBox="0 0 24 24" width="42" height="42">
                    <path d="M20.094 6S22 6 22 8v10.017S22 20 19 20H4.036S2 20 2 18V7.967S2 6 4 6h3s1-2 2-2h6c1 0 2 2 2 2h3.094zM12 16a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0 1.5a5 5 0 1 0-.001-10.001A5 5 0 0 0 12 17.5zm7.5-8a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" fill-rule="evenodd">

                    </path>
                </svg>
            </label>
        </div>
    </div>


    <div class="container-fluid">
        <div id='pad-wrapper'>
            <div id="editparent">
                <div class="fengmian" style="text-align:center">
              <!--  <input  id="fengmian" name="fengmian"  value="static/img/timg.jpeg" style="display:none" class="form-control input-sm"   maxlength="100"></input>-->
</div>
                <input type="text" id="title" style="font-size:40px;font-weight:bold;width:100%"  placeholder="请输入标题(最多50个字)"/>

                <div id='editControls' class='span12' style='text-align:center; padding:5px;'>

                    <div class='btn-group'>


                        <a class='btn' id="addImgBtn" data-role='InsertImage' href='#'><i class='fa fa-image'></i></a>
                        <a class='btn' id="addImgLink" data-role='InsertImageLink' href='#'><b>图片链接</b></a>

                        <a class='btn' id="addCodeBtn" data-role='pre' href='#'><b>代码</b></a>
                    </div>

                    <div class='btn-group'>

                        <a class='btn' data-role='RemoveFormat' href='#'><i class='fa fa-eraser'></i></a>
                        <a class='btn' data-role='undo' href='#'><i class='fa fa-undo'></i></a>
                        <a class='btn' data-role='redo' href='#'><i class='fa fa-repeat'></i></a>
                    </div>
                    <div class='btn-group'>

                        <a class='btn' data-role='bold' href='#'>
                             <b>Bold</b></a>
                        <a class='btn' data-role='italic' href='#'><em>Italic</em></a>
                        <a class='btn' data-role='underline' href='#'><u><b>U</b></u></a>
                        <a class='btn' data-role='strikeThrough' href='#'><strike>abc</strike></a>
                    </div>
                    <div class='btn-group'>
                        <a class='btn' data-role='justifyLeft' href='#'><i class='fa fa-align-left'></i></a>
                        <a class='btn' data-role='justifyCenter' href='#'><i class='fa fa-align-center'></i></a>
                        <a class='btn' data-role='justifyRight' href='#'><i class='fa fa-align-right'></i></a>
                        <a class='btn' data-role='justifyFull' href='#'><i class='fa fa-align-justify'></i></a>
                    </div>
                    <div class='btn-group'>
                        <a class='btn' data-role='indent' href='#'><i class='fa fa-indent'></i></a>
                        <a class='btn' data-role='outdent' href='#'><i class='fa fa-dedent'></i></a>
                    </div>
                    <div class='btn-group'>
                        <a class='btn' data-role='insertUnorderedList' href='#'><i class='fa fa-list-ul'></i></a>
                        <a class='btn' data-role='insertOrderedList' href='#'><i class='fa fa-list-ol'></i></a>
                    </div>
                    <div class='btn-group'>
                        <a class='btn' data-role='h1' href='#'>h<sup>1</sup></a>
                        <a class='btn' data-role='h2' href='#'>h<sup>2</sup></a>
                        <a class='btn' data-role='p' href='#'>p</a>
                    </div>
                    <div class='btn-group'>
                        <a class='btn' data-role='subscript' href='#'><i class='fa fa-subscript'></i></a>
                        <a class='btn' data-role='superscript' href='#'><i class='fa fa-superscript'></i></a>
                    </div>
                </div>
                <div id='editor' class='span12' style='' contenteditable>

                </div>




            </div>
        </div>
    </div>
</div>



<script src="../../../static/js/imageUtil.js" charset="UTF-8"></script>
<script src="../../../static/js/zwcommon.js" charset="UTF-8"></script>
<script src="../../../static/js/dom.js" charset="UTF-8"></script>

<script src="../../../static/js/jquery.min.js"></script>

<script src="../../../static/js/bootstrap.min.js"></script>
<script>

            $(function() {
                $('#editControls a').click(function(e) {
                    switch($(this).data('role')) {
                        case 'h1':
                        case 'h2':
                        case 'pre':
                        case 'p':
                            document.execCommand('formatBlock', false, '<' + $(this).data('role') + '>');
                            break;

                        //  document.execCommand('formatBlock', false, '<' + $(this).data('role') + '>');
                            break;
                         case 'InsertImage':
                          //  document.execCommand('InsertImage', true, 'https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=1365155501,963298376&fm=173&app=25&f=JPEG?w=218&h=146&s=BFB151870E09305D14F4C8AF0300F003');
                            addImage(e);
                            //document.execCommand('insertHtml', true, '<img class="artical-img" onclick="changeImage(this)" src=\'https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=1365155501,963298376&fm=173&app=25&f=JPEG?w=218&h=146&s=BFB151870E09305D14F4C8AF0300F003\'</img>');
                            break;
                         //case 'pre':
                          //  document.execCommand('insertHtml', true, '<pre>111  <span>在这里输入代码</span></pre>');
                           // break;
                         case 'InsertImageLink':
                            var word = prompt("请输图片地址","");
                            if(word){
                                 //输出word的格式
                               //  alert("已获得:"+word);
                                document.getElementById("editor").focus();
                                 document.execCommand('insertHtml', true, '<img   onclick="changeImage(this)"   class="artical-img" src=\''+word+'\'</img>');

                             }
                            break;
                        default:
                            document.execCommand($(this).data('role'), false, null);
                            break;
                    }

                })
            });

function addImage(e){

   // document.execCommand('insertHtml', true, '<img onclick="changeImage(this)" src=\'https://ss2.baidu.com/6ONYsjip0QIZ8tyhnq/it/u=1365155501,963298376&fm=173&app=25&f=JPEG?w=218&h=146&s=BFB151870E09305D14F4C8AF0300F003\'</img>');


}


var imageUtil=new zImageUtil2({"clickUploadDom":123
,"fileInput":document.getElementById("fileInput")
,"imgDom":document.getElementById("update-img"),"input":"fengmian",'callback':function(data){
document.getElementById("upload-svn").style.display="none";
$("#fengmian").val(data.data);
alert(data.data);
$(".WriteTitleImage").show();
}
});
var imageUtil=new getUploadImag({"clickDom":document.getElementById("addImgBtn"),"callback":function(src){//alert(src.data);



document.getElementById("editor").focus();
document.execCommand('insertHtml', true, '<img  class="artical-img" onclick="changeImage(this)" src=\''+PATH+"/"+src.data+'\'></img>');
}});


function submit(){
    var title = document.getElementById("title").value;
    var content = document.getElementById("editor").innerHTML;
    var pic = document.getElementById("fengmian").value;
    var json = {"title":title,content:content,pic:pic,type:1};
    Ajax.post("/home/article/save.json",json,function(data){

        console.log(data);
    });
}
</script>


<style>
    .artical-img{
        display:block;
    width:50%;
    }
    * {
    margin: 0;
    padding: 0
    }

    .box {
    position: absolute;
    top: 100px;
    left: 100px;
    }

    /*四边*/
    .box .t,
    .box .b,
    .box .l,
    .box .r {
    position: absolute;
    z-index: 1;
    background:#666;
    }

    .box .l,
    .box .r {
    width: 10px;
    height: 100%;
    cursor: col-resize;
    }

    .box .t,
    .box .b {
    width: 100%;
    height: 10px;
    cursor: row-resize;
    }

    .box .t {
    top: 0;
    }

    .box .b {
    bottom: 0;
    }

    .box .l {
    left: 0;
    }

    .box .r {
    right: 0;
    }

    /*四角*/
    .box .tl,
    .box .bl,
    .box .br,
    .box .tr {
    width: 20px;
    height: 20px;
    position: absolute;
    background: #CCC;
    z-index: 2;
    cursor: nwse-resize
    }

    .box .tl,
    .box .bl {
    left: -5px;
    }

    .box .tr,
    .box .br {
    right: -5px;
    }

    .box .br,
    .box .bl {
    bottom: -5px;
    }

    .box .tl,
    .box .tr {
    top: -5px;
    }

    .box .tr,
    .box .bl {
    cursor: nesw-resize;
    }

    /*图片*/
    img {
    width: 100%;
    height: 100%;
    }
</style>
<script>

function getInfo(o){//取得坐标
		if(isNull(o)){
	     	alert("can't find it:"+o);

     	}
	   	var to=new Object();
	   	to.left=to.right=to.top=to.bottom=0;

	   	var twidth=o.offsetWidth;
	   	var theight=o.offsetHeight;
	   	while(o!=document.body && !isNull(o)){
	   		if(isNull(o.offsetParent)){
	     		alert("can't find it's parentNode1:"+o);
	     	}
	     	to.left+=o.offsetLeft;
	     	to.top+=o.offsetTop;

     		o=o.offsetParent;
	   	}
     	to.right=to.left+twidth;
     	to.bottom=to.top+theight;
	   	return to;
}
  function changeImage(image) {

  setTimeout(function(){document.getElementById("box").style.display="block";},300);

            var oDiv = document.getElementsByClassName('box')[0];

            var posInfo = getInfo(image)

            oDiv.style.width = image.offsetWidth+"px";
            oDiv.style.height = image.offsetHeight+"px";

            console.log(posInfo);
            oDiv.style.top=posInfo.top+"px";
            oDiv.style.left=posInfo.left+"px";
            var aSpan = oDiv.getElementsByTagName('span');
            for (var i = 0; i < aSpan.length; i++) {
                dragFn(aSpan[i]);
            }

            function dragFn(obj) {
                obj.onmousedown = function (ev) {
                    var oEv = ev || event;

                    var oldWidth = oDiv.offsetWidth;
                    var oldHeight = oDiv.offsetHeight;
                    var oldX = oEv.clientX;
                    var oldY = oEv.clientY;
                    var oldLeft = oDiv.offsetLeft;
                    var oldTop = oDiv.offsetTop;

                    document.onmousemove = function (ev) {

                        var oEv = ev || event;






                        if (obj.className == 'tl') {
                            oDiv.style.width = oldWidth - (oEv.clientX - oldX) + 'px';
                            oDiv.style.height=oldHeight-(oEv.clientY-oldY)+'px';
                            oDiv.style.left = oldLeft + (oEv.clientX - oldX) + 'px';
                            oDiv.style.top = oldTop + (oEv.clientY - oldY) + 'px';
                        }
                        else if (obj.className == 'bl') {
                            oDiv.style.width = oldWidth - (oEv.clientX - oldX) + 'px';
                            oDiv.style.height=oldHeight+(oEv.clientY-oldY)+'px';
                            oDiv.style.left = oldLeft + (oEv.clientX - oldX) + 'px';
                            oDiv.style.bottom = oldTop + (oEv.clientY + oldY) + 'px';
                        }
                        else if (obj.className == 'tr') {
                            oDiv.style.width = oldWidth + (oEv.clientX - oldX) + 'px';
                            oDiv.style.height = oldHeight - (oEv.clientY - oldY)+'px';
                            oDiv.style.right = oldLeft - (oEv.clientX - oldX) + 'px';
                            oDiv.style.top = oldTop + (oEv.clientY - oldY) + 'px';
                        }
                        else if (obj.className == 'br') {
                            oDiv.style.width = oldWidth + (oEv.clientX - oldX) + 'px';
                            oDiv.style.height = oldHeight + (oEv.clientY - oldY)+'px';
                            oDiv.style.right = oldLeft - (oEv.clientX - oldX) + 'px';
                            oDiv.style.bottom = oldTop + (oEv.clientY + oldY) + 'px';
                        }
                        else if (obj.className == 't') {
                            oDiv.style.height=oldHeight-(oEv.clientY-oldY)+'px';
                            oDiv.style.top = oldTop + (oEv.clientY - oldY) + 'px';
                        }
                        else if (obj.className == 'b') {
                            oDiv.style.height = oldHeight + (oEv.clientY - oldY)+'px';
                            oDiv.style.bottom = oldTop - (oEv.clientY + oldY) + 'px';
                        }
                        else if (obj.className == 'l') {
                            oDiv.style.height = oldHeight + 'px';
                            oDiv.style.width = oldWidth - (oEv.clientX - oldX) + 'px';
                            oDiv.style.left = oldLeft + (oEv.clientX - oldX) + 'px';
                        }
                        else if (obj.className == 'r') {
                            oDiv.style.height = oldHeight + 'px';
                            oDiv.style.width = oldWidth + (oEv.clientX - oldX) + 'px';
                            oDiv.style.right = oldLeft - (oEv.clientX - oldX) + 'px';
                        }
                                  var posInfo = getInfo(image)

            image.style.width = oDiv.offsetWidth+"px";
            image.style.height = oDiv.offsetHeight+"px";

            console.log(posInfo);
            oDiv.style.top=posInfo.top+"px";
            oDiv.style.left=posInfo.left+"px";
                    };

                    document.onmouseup = function () {
                        document.onmousemove = null;
                    };
                    return false;
                };
            }

        };

        window.onload = function () {
            var oDiv = document.getElementsByClassName('box')[0];
            oDiv.style.width = '500px';
            var aSpan = oDiv.getElementsByTagName('span');
            for (var i = 0; i < aSpan.length; i++) {
                dragFn(aSpan[i]);
            }

            function dragFn(obj) {
                obj.onmousedown = function (ev) {
                    var oEv = ev || event;

                    var oldWidth = oDiv.offsetWidth;
                    var oldHeight = oDiv.offsetHeight;
                    var oldX = oEv.clientX;
                    var oldY = oEv.clientY;
                    var oldLeft = oDiv.offsetLeft;
                    var oldTop = oDiv.offsetTop;

                    document.onmousemove = function (ev) {
                        var oEv = ev || event;

                        if (obj.className == 'tl') {
                            oDiv.style.width = oldWidth - (oEv.clientX - oldX) + 'px';
                            oDiv.style.height=oldHeight-(oEv.clientY-oldY)+'px';
                            oDiv.style.left = oldLeft + (oEv.clientX - oldX) + 'px';
                            oDiv.style.top = oldTop + (oEv.clientY - oldY) + 'px';
                        }
                        else if (obj.className == 'bl') {
                            oDiv.style.width = oldWidth - (oEv.clientX - oldX) + 'px';
                            oDiv.style.height=oldHeight+(oEv.clientY-oldY)+'px';
                            oDiv.style.left = oldLeft + (oEv.clientX - oldX) + 'px';
                            oDiv.style.bottom = oldTop + (oEv.clientY + oldY) + 'px';
                        }
                        else if (obj.className == 'tr') {
                            oDiv.style.width = oldWidth + (oEv.clientX - oldX) + 'px';
                            oDiv.style.height = oldHeight - (oEv.clientY - oldY)+'px';
                            oDiv.style.right = oldLeft - (oEv.clientX - oldX) + 'px';
                            oDiv.style.top = oldTop + (oEv.clientY - oldY) + 'px';
                        }
                        else if (obj.className == 'br') {
                            oDiv.style.width = oldWidth + (oEv.clientX - oldX) + 'px';
                            oDiv.style.height = oldHeight + (oEv.clientY - oldY)+'px';
                            oDiv.style.right = oldLeft - (oEv.clientX - oldX) + 'px';
                            oDiv.style.bottom = oldTop + (oEv.clientY + oldY) + 'px';
                        }
                        else if (obj.className == 't') {
                            oDiv.style.height=oldHeight-(oEv.clientY-oldY)+'px';
                            oDiv.style.top = oldTop + (oEv.clientY - oldY) + 'px';
                        }
                        else if (obj.className == 'b') {
                            oDiv.style.height = oldHeight + (oEv.clientY - oldY)+'px';
                            oDiv.style.bottom = oldTop - (oEv.clientY + oldY) + 'px';
                        }
                        else if (obj.className == 'l') {
                            oDiv.style.height = oldHeight + 'px';
                            oDiv.style.width = oldWidth - (oEv.clientX - oldX) + 'px';
                            oDiv.style.left = oldLeft + (oEv.clientX - oldX) + 'px';
                        }
                        else if (obj.className == 'r') {
                            oDiv.style.height = oldHeight + 'px';
                            oDiv.style.width = oldWidth + (oEv.clientX - oldX) + 'px';
                            oDiv.style.right = oldLeft - (oEv.clientX - oldX) + 'px';
                        }
                    };

                    document.onmouseup = function () {
                        document.onmousemove = null;
                    };
                    return false;
                };
            }

        };

function isNull(str) {
		if(typeof str != 'string'){
			//alert("isNull 使用错误,参数是" +(typeof str));
			if(typeof str == 'undefined' || null == str){
				return true
			}else{
				return false;
			}
		}else
	if (typeof str == 'undefined' || str == null || str.trim() == '')
		return true;
	else
		return false;

}

document.body.addEventListener("click",function(){

    document.getElementById("box").style.display="none";
})


function addImgLink(){

    var word = prompt("请输图片地址","");
        if(word){
             //输出word的格式
             alert("已获得:"+word);
         }
}

</script>

<div style="display:none" class="box" id="box">
    <span class="r"></span>
    <span class="l"></span>
    <span class="t"></span>
    <span class="b"></span>
    <span class="br"></span>
    <span class="bl"></span>
    <span class="tr"></span>
    <span class="tl"></span>
    <img style="visibility:hidden" src="https://gss0.bdstatic.com/70cFsjip0QIZ8tyhnq/img/iknow/730-350-0.jpg">
</div>
</body>
</html>